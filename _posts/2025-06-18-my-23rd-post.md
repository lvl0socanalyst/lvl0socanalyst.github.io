---
layout: post
title:  "Shai-Hulud NPM Package Worm! (Stuxnet NPM Edition)"
date:   2025-09-09 21:00:00 +1000
categories: threat intel
---

<style>
  body { font-size: 16px; }
  body {font-family: 'Inter', sans-serif}
  h1 { font-size: 19px !important; }
  h2 { font-size: 17px !important; }
  h3 { font-size: 15px !important; }
</style>

## Overview

Empire strikes back (DPRK) to steal more secrets!

Popular npm package Tinycolor (plus a casual other 38) we're compromised on the 15th of September 2025 with a worm that self-propagates and infects other packages (plus + cred/crypto stealing malware)!

Similar to the 'S1ngualarity' npm package compromise the malicious JS attempts to exfil:
- GitHub PAT tokens
- NPM Auth tokens
- Crypto

But with further functionality to exfil:
- GCP, Azure, AWS access keys and creds

### Threat Actor Attribution

Now although not confirmed, my money is on DPRK. 

The two exfil methods we're github public repo dumping and a webhook with a known webhook provider. This doesn't give any pivots to work off, therefore its hard to track this back to adversary infrastructure. 

In terms of how they compromised the npm package owner's account, no one knows, as old mate Scooter Cooper (scttcper) swears he wasn't phished.

![alt text](/images/scott.PNG)

So if the initial access vector ever comes out, hopefully we have some IOAs that we can search and try to attribute to an actor.

Until then, it was DPRK!!

### Self Propagating Aspect

Shai-Hulud is actually a big worm in Dune. It's pretty much the non copyright version of the Exogorth worm from Star Wars Empire Strikes Back.

Anyhow, to the actual worm.

![alt text](/images/shai_worm.PNG)

The worm relies on the npm credentials discovered on the host to spread to other packages owned by that author. 

If found it invokes the ``updatePackage`` function. Which appends the same ``bundle.js`` as a post install script to all packages owned by the now compromised npm account.

Adding a postinstall script to ``package.json`` in an npm package means everytime it's ran, it runs the script. Pretty neat.

### TruffleHog

Bundle.js uses TruffleHog to scan for secrets. (https://github.com/trufflesecurity/trufflehog)

TruffleHog is a go program that is used to discover secrets absolutely everywhere. Git, Cloud, File systems the lot. Ohhh and crypto, the crown jewels. If anyone has a browser extension crypto wallet they should detonate there computer.`                             

I had never heard of this prior to this incident. So I've cloned it and cracked it open on my Kali box.

Let's scan it on my Git repo and see what we get. 

![alt text](/images/trufflehog_result.PNG)

Well, looks like I'm covered for my website repo.

Can also use it to scan a directory. Lets create a txt file with a password in it and see if trufflehog picks it up.

![alt text](/images/truffle_success_result.PNG)

Alright this is what the output looks like when it's successful, pretty neat.

### Error Beep Bop

Did someone forget to pay for a webhook? 

Imagine sending all these POST requests to a webhook chockas full of crypto wallet logins and PAT tokens. Only to have them return 400s because the webhook has exceeded it's daily limit for the free tier.

![alt text](/images/webhook.PNG)

When you boot up Webhook[.]site you get a free webhook. With the free version you're rate limited to 100 requests. If you pay a measely $9 a month, that 100 requests is now unlimited. Wild.

I find it hilarious that a group has written a self-propgating js worm with infostealer capabilities but make this much of a blunder. 

Fully epic stuff.