---
layout: post
title:  "NetSupport RAT"
date:   2025-09-09 21:00:00 +1000
categories: malware
---

<style>
  body { font-size: 16px; }
  body {font-family: 'Inter', sans-serif}
  h1 { font-size: 19px !important; }
  h2 { font-size: 17px !important; }
  h3 { font-size: 15px !important; }
</style>

## Overview

Standard Cloudflare turnstile that leads to a lure to paste a command into windows run. Looking into the malware from start to finish, statically, cause it's funner.

### Clickfix Prompt 

Indian consulting company was popped. 

hXXps://alp[.]consulting

The following clickfix prompt was appended to the website 

### .Wav File (Dropper)

I've got 11.5mbs of wav file.

When I open it up it is actually a powershell file. 

If we have a look at the clickfix command it actually saves the .wav as a .ps1

I assume this a method to bypass detection mechanisms that may prevent/inspect downloads with certain extensions (proxy).

### .Ps1 File (Loader)

I'll save the .wav as a .ps1

First glance. Looks like some minor obfuscation. And lots of bytes.

![alt text](/images/ps1_netsupport.PNG)

What I can see:
- Creates a marker file in the /Temp directory as '__init__log'
- Writes some jargon on the screen. Likely to trick the user into thinking it's verifying there identity.
- Defines `$LjLSTACGF` as a file/file path `(Documents/HZze39v1.wav)`
- Defines `$xϞzzghϞ` and assigns it a lot of bits and bytes 

Now that weird variable name `$xϞzzghϞ`. The lightning bolt symbol things is supposedly the greek letter 'Koppa'. Cool I guess.

Let's scroll down and see what else we have

![alt text](/images/ps1_netsupport2.PNG)

Now bit to unpack, I'll go through each line one by one.

![alt text](/images/n1.PNG)

Alright we've got the variable `$kKtyJL`. This looks to consist of the bytes in `xϞzzghϞ`, `mcZΛkϞπ` and `RζπrMwGEQi`

So, when I search for the two unknown variables `mcZΛkϞπ` and `RζπrMwGEQi` they muchlike `xϞzzghϞ` have a bunch of bits and bytes.

So what we are seeing is `$kKtyJL` now contains all the bytes from those three variables. So currently that is our payload/bytes we want to track further down this script.

![alt text](/images/n2.PNG)

So here it is writing the raw bytes of `$kKtyJL` to the variable `$LjLSTACGF` which if you remember from earlier is the filepath `Documents\HZze39v1.wav`.

![alt text](/images/n4.PNG)

`$weBRvm` sets the new desired file path `Documents\HZze39v1.zip`

And the second line of code actually renames the file `HZze39v1.wav` to `HZze39v1.zip`

![alt text](/images/n5.PNG)

These two lines create a folder in Documents called `PwNRbgjSHr`

So now in documents we have two modifications made by the script:
- `Documents\HZze39v1.zip` (re-naming and creation of .zip with bytes inside) ($weBRvm)
- `Documents\PwNRbgjSHr` (creation of folder) ($CRKaNcWH)

Bloody tough tracking all these varibles. But, we are interested in `$weBRvm` as that has the bytes!

![alt text](/images/n6.PNG)

Attempts to make the `Documents\PwNRbgjSHr` hidden.

![alt text](/images/n7.PNG)

Has a breather. Everyone needs a timeout.

![alt text](/images/n8.PNG)

Expands the contents of `$weBRvm` and writes it to the path `$CRKaNcWH`

![alt text](/images/n9.PNG)

Removes evidence of `$weBRvm`

It now lives in here `Documents\PwNRbgjSHr`

![alt text](/images/n13.PNG)

Creates a new variable `$ziπbKVG` and writes the bytes of our payload stored in `Documents\PwNRbgjSHr` to an .exe named `client32.exe`

![alt text](/images/n12.PNG)

Has another breather. Gee whiz this script must be working hard.

![alt text](/images/ps1_netsupport3.PNG)

Creates a few new variables here:
- `$wd` is `Documents\PwNRbgjSHr\client32.exe` file
- `$exe` is now `Documents\PwNRbgjSHr\client32.exe`
- `$quoted` is now `Documents\PwNRbgjSHr\client32.exe` which some character spaces either side.

`$cmdline` is assigned the string `'forfiles /p C:\Windows\System32 /m calc.exe /c "cmd /c start \"\" \"C:\Windows\explorer.exe\" ' + $quoted + ' \""'`

Well, this is new.

Forfiles.exe (windows binary) finds calc.exe (windows binary) which in turn opens explorer.exe (windows binary) to run `$quoted` which is `Documents\PwNRbgjSHr\client32.exe`

`cmd.exe /c $cmdLine`

Then it is ran using cmd.exe

![alt text](/images/ps1_netsupport4.PNG)

Now this is cool. Creates a run key in registry for `$ziπbKVG` which is `client32.exe`

Names it 'SecureModule'. Epic.

`try { Remove-Item -Path $MyInvocation.MyCommand.Path -Force } catch {}`

Last but not least! Cleanup! 

Deletes the file from disk. That being the script we ran wayyyyy back at the start.

### Client32.exe

So let's try print out our payload `client32.exe` and whack it into some analysis tools. 

But first I've got to build it safely.

![alt text](/images/ps1_netsupport5.PNG)

I've commented out a bunch of code and renamed it to understand it. But essentially I'm building the file with the bytes and naming it `nothanks.zip`

Lets extract and peek inside.

![alt text](/images/netsupport_folder.PNG)

What we have here is NetSupport RAT.

Which is an RAT created by "netsupportsoftware.com" that has been re-purposed and used for nefarious reaosns.

![alt text](/images/netsupport_hash.PNG)

The hash lights up like a christmas tree in VT.

![alt text](/images/netsupport_strings.PNG)

Running strings on 'Client32.exe' shows the author 'netsupportsoftware.com'

What I now need to do is find an IP. Where is the beacon pinging out to. Yes I could run in a sandbox but that's not as fun as looking for a needle in a haystack.

### Finding exfilitration IOCs

`\b(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?::\d{1,5})?\b`

I got ChatGPT to spin me up this regex query looking for an IP and/or IP + port pattern.

I've then ran this regex query in the strings module in Detect It Easy (DiE) for all the files. And I have a few hits. But no clear IPs.

Whilst I'm manually opening each file in (DiE) and pasting the regex query in the strings module I had an idea. I can probably script this function using PowerShell and rather than give it one regex query. Give it 5-6. One for domains, one for IP, one for 'ClientIP' perhaps. 

So I'm gonna build a script to do so.

Annndddd here is the script [Strings64 Regex IOC Powershell Script](https://lvl0socanalyst.github.io/scripts/2025/09/09/my-27th-post.html)

When I run my script I get a lot of junk. I originally get about 600 lines of results after scanning the files in the directory with 5 different regex patterns.

But after spending a few minutes panning for gold we have a few domains.

![alt text](/images/n14.PNG)

IP, B64, URL and email search looks dry.

But, three spicy looking domains there.
- basketballast[.]com
- blueprintsfdskjhfd[.]com
- netsupport247[.]com

Lets whack these into VT and see what we can get.

![alt text](/images/n15.PNG)

2/3 light up. Hell yeah. I've found the C2 domains. Lets try and see who owns these!

### Threat Hunting for Attacker Infrastructure

Alright we have two domains addresses as a pivot. Lettuce pray these aren't sitting behind Cloudflare.

![alt text](/images/n16.PNG)

Nslookup indicates both domains are behind the same IP 62[.]164[.]177[.]48

Sweet not a cloudflare IP, awesome.

![alt text](/images/n1.PNG)

Cool, weird ASN 'Data Campus Limited'

![alt text](/images/n18.PNG)

Own very few IPs as well. Based in Hong Kong. Spicy.

Anyhow, lets see what OSINT can tell us about this IP.

![alt text](/images/n17.PNG)

We've got 23 domains resolving to 62[.]164[.]177[.]48

Naming convention is somewhat similar. My guess is these are C2 domains as well.

Shodan shows that RDP port is open. No vulns. Running Windows Server 2022. 

What is interesting is some of the other IPs within the 62[.]164[.]177[.]48/28 CIDR range.

![alt text](/images/n19.PNG)

Particularly these two.

Sectop RAT. Deployed on different ports. This could likely be another threat actor, however, it could also be the same actor.

In summary this is what we have determined. An indian consulting company website was popped. As a result a Clickfix Prompt from the IUAM Cickfix Kit was deployed on there site. Clickfix prompt used a basic dropper to load NetSupport RAT on disk. 

We have the following artefacts:
- 64[.]188[.]91[.]240 (Dropper IP)
- 62[.]164[.]177[.]48 (C2 Domain resolution)
- basketballast[.]com (C2 Domain)
- blueprintsfdskjhfd[.]com (C2 Domain)
- clp[.]consulting (compromised website)
- Basic dropper was used
- Little obfuscation and no encryption in loader
- NetSupport RAT deployed (ran on disk (simple deployment))
- Domains we're not new and known malicious for some time
- IP is an odd ASN
- IUAM Clickfix Kit likely used (therefore, non sosphiticated attackers?)