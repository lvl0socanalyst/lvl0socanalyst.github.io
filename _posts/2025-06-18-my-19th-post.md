---
layout: post
title:  "BrowserBuddy - Safe Browsing Browser Extension"
date:   2025-06-16 21:00:00 +1000
categories: project
---

<style>
  body { font-size: 16px; }
  body {font-family: 'Inter', sans-serif}
  h1 { font-size: 19px !important; }
  h2 { font-size: 17px !important; }
  h3 { font-size: 15px !important; }
</style>

## Overview

BrowserBuddy - Chrome Extension. 

A browser extension that prevents dodgy JavaScript. 

With Clickfix prompts on the rise, malicious browser extensions and drive by downloads tearing apart the real OS (the browser) I thought up this idea.

This by no means is something new. However, the scope is kind of endless with this. The idea is too slowly build this out and see where it goes. 

## Features

These will be added to overtime.

### BrowserBuddy Toggle 

Functionality to be toggled on/off 

![Stage 1](/images/browser_buddy_off.PNG)

![Stage 2](/images/browser_buddy_on.PNG)

### Basic security features

- Don't allow connections to HTTP
- - Enforce HTTPs??
- File downloads that masquerade as other extensions (e.g. .exe.pdf)
- Regex to try and pick out domain spoofing (e.g paypa1.com)

### Exclude Domains from BrowserBuddy 

To avoid breaking website functionality browserbuddy allows users to exclude domains.

Here is an example of me trying to copy some text from Cyberchef.

![Stage 1](/images/browser_buddy_block.PNG)

As you can see it doesn't work!

So let's create an exclusion.

![Stage 1](/images/browser_buddy_exclusion.PNG)

We whack our domain into the box above and hit the magic button.

![Stage 1](/images/browser_buddy_exclusion_clicked.PNG)

As you can see the exclusion has been created. Now let's test it.

![Stage 1](/images/browser_buddy_copy_works.PNG)

Now I can use CyberChef without having to turn the extension off.

These exclusions are saved locally (chrome.storage.local). Therefore, when users restart there browsers the exclusion list remains. 

### Blocking JavaScript Clipboard APIs

First successful addition to this is the blocking of JS Clipboard APIs. 

There are two JS APIs that trigger this. Both of them suck
- navigator.clipboard.writeText()
- document.execCommand()

Essentially I have blocked the 'programmatic' copy to a user's clipboard. 

What can still happen: 
- Ctrl+C 
- Right click --> Copy 

What can't happen:
- Webpages copying text automatically to clipboard using JS APIs
- User cannot click a copy button on a website

So business impact? Sounding real corporate. Users unable to interact with copy buttons on websites.

To demonstrate the functionality I'll boot up a live Clickfix prompt and see how BrowserBuddy behaves.


1. Navigate to ClickFix site with BrowserBuddy installed


![Stage 1](/images/browser_buddy_clickfix_stop.PNG)


2. BrowserBuddy blocks the JS programmatic copy=======


![Stage 2](/images/browser_buddy_clickfix_popup.PNG)


3. BrowserBuddy prints the command to the log


![Stage 3](/images/browser_buddy_log.PNG)

### Blocking Push Notifications

I recently wrote an article on a new type of Cloudflare Clickfix (link here). In summary I found the prompt was subscribing browsers to push notifications. These subscriptions we're then being sold off for crypto on the threat actors website. 

Anywho, got me thinking I should add this as a feature. Because honestly, when is this used legitimately?

The JS API allowing this functionality is ``Notification.requestPermission()``

![Stage 3](/images/push_example.PNG)

That API creates the allow or block popup above.

Now lets give it a go, with BrowserBuddy enabled.

![Stage 3](/images/notification_blocked.PNG)

As we can see it's blocked. 

Now, push notifications are used legitimately by many websites. So we can create an exclusion in browser buddy so functionality isn't broken. 

### Domain reputation checker

This function fetches an updated list of current threats from my MISP server. If the user visits any of them. The request will be blocked.

The idea is to have my MISP server provide the most current threats. The extension will call out to my MISP API once every hour for a new list.

This list will contain no more than 5000 domains. As that is the limit provided for the declarativeNetRequest API which will be used for this.

Unfortunately, this requires me to get my MISP server up and going again. Which isn't cheap.. Thanks AWS.

### Hash checker

This function generate the hash of files downloaded by the user. It then queries the VT API for the reputation of this file. If the file has a poor reputation the file will be blocked by BrowserBuddy.

This is quite resource intensive as it requires the browser to take over the download process. Furthermore, the VT API has it's limits for the free tier. So this will need to be considered as well.

I think it is possible. 

### 